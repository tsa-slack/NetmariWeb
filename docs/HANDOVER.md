# Netomariï¼ˆãƒãƒˆãƒãƒªï¼‰é–‹ç™ºå¼•ãç¶™ãè³‡æ–™

> **æœ€çµ‚æ›´æ–°**: 2026-02-11  
> **è‘—è€…**: å‰ç”° æµ©æ¨¹
> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ãƒ»ä¾å­˜é–¢ä¿‚](#3-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ä¾å­˜é–¢ä¿‚)
4. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#4-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
5. [èªè¨¼ãƒ»æ¨©é™ç®¡ç†](#5-èªè¨¼æ¨©é™ç®¡ç†)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#6-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
7. [ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤](#7-ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤)
8. [å¤–éƒ¨APIé€£æº](#8-å¤–éƒ¨apié€£æº)
9. [ä¸»è¦æ©Ÿèƒ½ã®å®Ÿè£…è©³ç´°](#9-ä¸»è¦æ©Ÿèƒ½ã®å®Ÿè£…è©³ç´°)
10. [ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸€è¦§](#10-ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸€è¦§)
11. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#11-é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
12. [ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤](#12-ãƒ“ãƒ«ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤)
13. [ãƒ†ã‚¹ãƒˆ](#13-ãƒ†ã‚¹ãƒˆ)
14. [æ—¢çŸ¥ã®èª²é¡Œãƒ»ä»Šå¾Œã®æ”¹å–„ç‚¹](#14-æ—¢çŸ¥ã®èª²é¡Œä»Šå¾Œã®æ”¹å–„ç‚¹)
15. [é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](#15-é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

**Netomariï¼ˆãƒãƒˆãƒãƒªï¼‰** ã¯è»Šä¸­æ³Šãƒ»ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒ©ã‚¤ãƒ•ã‚’æ¥½ã—ã‚€äººã€…ã®ãŸã‚ã®ç·åˆã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

### ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
> ã€Œã©ã“ã§ã‚‚ã€å¯æ³Šã¾ã‚Šã‚’ã€‚ã€

### ä¸»è¦æ©Ÿèƒ½
| æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒª | å†…å®¹ |
|---|---|
| ğŸš è»Šä¸¡ã‚«ã‚¿ãƒ­ã‚° | è²©å£²è»Šä¸¡ã®ä¸€è¦§ãƒ»è©³ç´°ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| ğŸ”‘ ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ•ãƒ­ãƒ¼ | è»Šä¸¡é¸æŠ â†’ æ©Ÿå™¨é¸æŠ â†’ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£é¸æŠ â†’ äºˆç´„ç¢ºèª |
| ğŸ“ ä½“é¨“è¨˜ | Markdown è¨˜äº‹ã®æŠ•ç¨¿ãƒ»ã„ã„ã­ãƒ»ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ»è³ªå•/å›ç­” |
| â“ Q&A | ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ãƒ»ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼ãƒ»å½¹ç«‹ã£ãŸæŠ•ç¥¨ |
| ğŸ—ºï¸ å”åŠ›åº—ãƒãƒƒãƒ— | Leaflet åœ°å›³æ¤œç´¢ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ãŠæ°—ã«å…¥ã‚Š |
| ğŸ“ å¯„ã‚Šé“ãƒ«ãƒ¼ãƒˆ | ãƒ«ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ãƒ»çµŒç”±åœ°è¿½åŠ ãƒ»ä¿å­˜/å…±æœ‰ |
| ğŸ‰ ã‚¤ãƒ™ãƒ³ãƒˆ | ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»å‚åŠ ç™»éŒ²ãƒ»å®šå“¡ç®¡ç† |
| â­ ãƒ¬ãƒ“ãƒ¥ãƒ¼ | 5æ®µéšè©•ä¾¡ãƒ»è‰¯ã„ç‚¹/æ‚ªã„ç‚¹ãƒ»ç”»åƒä»˜ã |
| ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | 4æ®µéšæ¨©é™ãƒ»ä¼šå“¡ãƒ©ãƒ³ã‚¯è‡ªå‹•æ˜‡æ ¼ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç† |
| ğŸ› ï¸ ç®¡ç†ç”»é¢ | 15ç”»é¢ä»¥ä¸Šã®Admin/Staffç®¡ç†æ©Ÿèƒ½ |

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React SPA (Vite + TypeScript)                        â”‚
â”‚                                                       â”‚
â”‚  Pages â”€â†’ Hooks (useQuery / useMutation)              â”‚
â”‚         â”€â†’ Repositories â”€â†’ Supabase JS Client         â”‚
â”‚         â”€â†’ Components (å…±æœ‰UI)                        â”‚
â”‚         â”€â†’ Contexts (AuthContext)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Platform                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ PostgreSQLâ”‚ â”‚ Auth     â”‚ â”‚ Edge Functions       â”‚â”‚
â”‚  â”‚ + RLS     â”‚ â”‚          â”‚ â”‚ (create-payment-     â”‚â”‚
â”‚  â”‚ (32 tables)â”‚ â”‚          â”‚ â”‚  intent)             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚            â”‚
â”‚  â”‚ Storage   â”‚ â”‚ REST API â”‚            â”‚            â”‚
â”‚  â”‚ (images)  â”‚ â”‚(PostgRESTâ”‚â”‚            â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
     â”‚ Google Maps API    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ (Placesæ¤œç´¢)       â”‚  â”‚ Stripe (æ±ºæ¸ˆ)          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart LR
    A[ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ] -->|useQuery/useMutation| B[ã‚«ã‚¹ã‚¿ãƒ Hooks]
    B -->|Repositoryå‘¼ã³å‡ºã—| C[Repository Layer]
    C -->|Supabase Client| D[Supabase REST API]
    D -->|RLSé©ç”¨| E[PostgreSQL]
    A -->|useAuth| F[AuthContext]
    F -->|supabase.auth| D
```

---

## 3. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ãƒ»ä¾å­˜é–¢ä¿‚

### ã‚³ã‚¢æŠ€è¡“

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|---|---|---|
| è¨€èª | TypeScript | 5.5 |
| UI | React | 18.3 |
| ãƒ“ãƒ«ãƒ‰ | Vite | 5.4 |
| CSS | Tailwind CSS | 3.4 |
| ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | React Router | v7 |
| çŠ¶æ…‹ç®¡ç† | React Context + ã‚«ã‚¹ã‚¿ãƒ Hooks | â€” |
| DB/Auth | Supabase | 2.57 |
| åœ°å›³ | Leaflet + React Leaflet | 1.9 / 4.2 |
| æ–½è¨­æ¤œç´¢ | Google Maps Places API | â€” |
| æ±ºæ¸ˆ | Stripe | 8.7 |
| ã‚¢ã‚¤ã‚³ãƒ³ | Lucide React | 0.344 |
| ãƒ•ã‚©ãƒ¼ãƒ  | React Hook Form + Zod | 7.71 / 4.3 |
| é€šçŸ¥ | Sonner (Toast) | 2.0 |
| ãƒ†ã‚¹ãƒˆ | Vitest + Testing Library | â€” |
| Lint | ESLint + TypeScript-ESLint | â€” |

### package.json ã®ä¸»è¦ä¾å­˜é–¢ä¿‚

**æœ¬ç•ª:**
- `@googlemaps/js-api-loader` â€” Google Maps JS API ã®ãƒ­ãƒ¼ãƒ€ãƒ¼
- `@stripe/stripe-js` â€” Stripe ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆSDK
- `@supabase/supabase-js` â€” Supabase JS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `leaflet` / `react-leaflet` â€” åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `lucide-react` â€” ã‚¢ã‚¤ã‚³ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- `react-hook-form` / `@hookform/resolvers` / `zod` â€” ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- `react-error-boundary` â€” ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª
- `sonner` â€” ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥

**é–‹ç™º:**
- `@types/google.maps` / `@types/leaflet` â€” å‹å®šç¾©
- `vitest` / `jsdom` / `@testing-library/*` â€” ãƒ†ã‚¹ãƒˆ
- `autoprefixer` / `postcss` â€” CSSå‡¦ç†

---

## 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
NetmariWeb/
â”œâ”€â”€ public/                      # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ API.md                   # APIå®šç¾©ãƒ»èªè¨¼ãƒ»RLSãƒ»æ¨©é™
â”‚   â”œâ”€â”€ DATABASE.md              # ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ãƒ»ERå›³ãƒ»é–¢æ•°
â”‚   â””â”€â”€ HANDOVER.md              # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ 20260207000000_complete_database_schema.sql  # çµ±åˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ functions/
â”‚       â””â”€â”€ create-payment-intent/  # Stripeæ±ºæ¸ˆ Edge Function
â”œâ”€â”€ scripts/                     # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                 # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ App.tsx                  # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®šç¾©ï¼ˆå…¨82ãƒ«ãƒ¼ãƒˆï¼‰
â”‚   â”œâ”€â”€ index.css                # ã‚°ãƒ­ãƒ¼ãƒãƒ«CSS
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx      # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå”¯ä¸€ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼‰
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useGoogleMapsLoader.ts   # Google Maps API ãƒ­ãƒ¼ãƒ€ãƒ¼
â”‚   â”‚   â”œâ”€â”€ useSystemSettings.ts     # ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®å–å¾—
â”‚   â”‚   â””â”€â”€ useUnsavedChanges.ts     # æœªä¿å­˜å¤‰æ›´ã®æ¤œå‡º
â”‚   â”œâ”€â”€ components/              # å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ27ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”œâ”€â”€ ProtectedRoute.tsx   # ãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰ï¼ˆèªè¨¼ãƒ»ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ï¼‰
â”‚   â”‚   â”œâ”€â”€ Header.tsx           # ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼‰
â”‚   â”‚   â”œâ”€â”€ Footer.tsx           # ãƒ•ãƒƒã‚¿ãƒ¼
â”‚   â”‚   â”œâ”€â”€ Layout.tsx           # Header + Footer ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”œâ”€â”€ AdminLayout.tsx      # ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ StaffSidebar.tsx     # ã‚¹ã‚¿ãƒƒãƒ•ã‚µã‚¤ãƒ‰ãƒãƒ¼
â”‚   â”‚   â”œâ”€â”€ PlaceAutocomplete.tsx  # Googleæ–½è¨­æ¤œç´¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ RouteMap.tsx         # Leafletåœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ImageUpload.tsx      # ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ ConfirmModal.tsx     # ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚   â”‚   â”œâ”€â”€ LoadingSpinner.tsx   # ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx       # ç©ºçŠ¶æ…‹è¡¨ç¤º
â”‚   â”‚   â”œâ”€â”€ ErrorState.tsx       # ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
â”‚   â”‚   â”œâ”€â”€ GlobalErrorBoundary.tsx  # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª
â”‚   â”‚   â”œâ”€â”€ ScrollToTop.tsx      # ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªã‚»ãƒƒãƒˆ
â”‚   â”‚   â”œâ”€â”€ category/            # ã‚«ãƒ†ã‚´ãƒªé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ partner/             # å”åŠ›åº—é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ rental/              # ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ•ãƒ­ãƒ¼é–¢é€£
â”‚   â”‚   â””â”€â”€ route/               # ãƒ«ãƒ¼ãƒˆé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ pages/                   # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ67ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”œâ”€â”€ HomePage.tsx         # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx        # ãƒ­ã‚°ã‚¤ãƒ³
â”‚   â”‚   â”œâ”€â”€ RegisterPage.tsx     # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
â”‚   â”‚   â”œâ”€â”€ MyPage.tsx           # ãƒã‚¤ãƒšãƒ¼ã‚¸ï¼ˆã‚¿ãƒ–åˆ‡æ›¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ my-page/             # ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚¿ãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ8ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ProfileTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReservationsTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ FavoritesTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StoriesTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReviewsTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RoutesTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsTab.tsx
â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â”œâ”€â”€ Rental*.tsx          # ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ•ãƒ­ãƒ¼ï¼ˆ5ãƒšãƒ¼ã‚¸ï¼‰
â”‚   â”‚   â”œâ”€â”€ Admin*.tsx           # ç®¡ç†ç”»é¢ï¼ˆ15+ãƒšãƒ¼ã‚¸ï¼‰
â”‚   â”‚   â”œâ”€â”€ Staff*.tsx           # ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢ï¼ˆ3ãƒšãƒ¼ã‚¸ï¼‰
â”‚   â”‚   â””â”€â”€ Partner*.tsx         # å”åŠ›åº—ç”»é¢ï¼ˆ6ãƒšãƒ¼ã‚¸ï¼‰
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ supabase.ts          # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
â”‚       â”œâ”€â”€ database.types.ts    # DBå‹å®šç¾©ï¼ˆsupabase gen types ã§ç”Ÿæˆï¼‰
â”‚       â”œâ”€â”€ logger.ts            # ãƒ­ã‚°ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ handleError.ts       # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”‚       â”œâ”€â”€ imageUpload.ts       # ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ schemas.ts           # Zod ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ
â”‚       â””â”€â”€ data-access/         # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ï¼ˆ37ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚           â”œâ”€â”€ base/
â”‚           â”‚   â”œâ”€â”€ BaseRepository.ts   # åŸºåº•ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ©ã‚¹
â”‚           â”‚   â”œâ”€â”€ QueryBuilder.ts     # ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼
â”‚           â”‚   â””â”€â”€ types.ts            # å…±é€šå‹å®šç¾©
â”‚           â”œâ”€â”€ hooks/
â”‚           â”‚   â”œâ”€â”€ useQuery.ts         # ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒƒã‚¯
â”‚           â”‚   â”œâ”€â”€ useMutation.ts      # ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ãƒ•ãƒƒã‚¯
â”‚           â”‚   â””â”€â”€ useRepository.ts    # ãƒªãƒã‚¸ãƒˆãƒªå–å¾—ãƒ•ãƒƒã‚¯
â”‚           â””â”€â”€ repositories/           # ãƒ†ãƒ¼ãƒ–ãƒ«å›ºæœ‰ãƒªãƒã‚¸ãƒˆãƒªï¼ˆ20å€‹ï¼‰
â”‚               â”œâ”€â”€ ActivityRepository.ts
â”‚               â”œâ”€â”€ AnnouncementRepository.ts
â”‚               â”œâ”€â”€ AnswerRepository.ts
â”‚               â”œâ”€â”€ CategoryRepository.ts
â”‚               â”œâ”€â”€ ContactRepository.ts
â”‚               â”œâ”€â”€ EquipmentRepository.ts
â”‚               â”œâ”€â”€ EventRepository.ts
â”‚               â”œâ”€â”€ EventParticipantRepository.ts
â”‚               â”œâ”€â”€ PartnerRepository.ts
â”‚               â”œâ”€â”€ QuestionRepository.ts
â”‚               â”œâ”€â”€ RentalChecklistRepository.ts
â”‚               â”œâ”€â”€ RentalFlowRepository.ts
â”‚               â”œâ”€â”€ ReservationRepository.ts
â”‚               â”œâ”€â”€ ReviewRepository.ts
â”‚               â”œâ”€â”€ RouteRepository.ts
â”‚               â”œâ”€â”€ StoryRepository.ts
â”‚               â”œâ”€â”€ StoryQuestionRepository.ts
â”‚               â”œâ”€â”€ SystemSettingsRepository.ts
â”‚               â”œâ”€â”€ UserRepository.ts
â”‚               â””â”€â”€ VehicleRepository.ts
â”œâ”€â”€ .env.sample                  # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tsconfig.json / tsconfig.app.json / tsconfig.node.json
â””â”€â”€ eslint.config.js
```

---

## 5. èªè¨¼ãƒ»æ¨©é™ç®¡ç†

### èªè¨¼æ–¹å¼

Supabase Auth ã‚’ä½¿ç”¨ã—ãŸãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã€‚JWT ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€‚

### èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant R as RegisterPage
    participant SA as Supabase Auth
    participant T as handle_new_user() ãƒˆãƒªã‚¬ãƒ¼
    participant DB as users ãƒ†ãƒ¼ãƒ–ãƒ«

    U->>R: ç™»éŒ²æƒ…å ±å…¥åŠ›
    R->>SA: signUp(email, password, metadata)
    SA->>T: AFTER INSERT ãƒˆãƒªã‚¬ãƒ¼
    T->>DB: INSERT INTO users (metadata ã‹ã‚‰å±•é–‹)
    SA-->>R: JWT ãƒˆãƒ¼ã‚¯ãƒ³è¿”å´
    R-->>U: ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«

| ãƒ­ãƒ¼ãƒ« | èª¬æ˜ | ã§ãã‚‹ã“ã¨ |
|---|---|---|
| `Admin` | ç®¡ç†è€… | å…¨æ©Ÿèƒ½ãƒ»å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ»ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´ |
| `Staff` | ã‚¹ã‚¿ãƒƒãƒ• | è»Šä¸¡/æ©Ÿå™¨ç®¡ç†ãƒ»è²¸å‡º/è¿”å´å‡¦ç†ãƒ»äºˆç´„ç®¡ç†ãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç† |
| `Partners` | å”åŠ›åº— | è‡ªåº—èˆ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç† |
| `Members` | ä¸€èˆ¬ä¼šå“¡ | ãƒ¬ãƒ³ã‚¿ãƒ«äºˆç´„ãƒ»æŠ•ç¨¿ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãŠæ°—ã«å…¥ã‚Š |

### ä¼šå“¡ãƒ©ãƒ³ã‚¯

| ãƒ©ãƒ³ã‚¯ | æ¡ä»¶ï¼ˆã„ãšã‚Œã‹ï¼‰ | å‰²å¼•ç‡ |
|---|---|---|
| Bronze | åˆæœŸçŠ¶æ…‹ | 0% |
| Silver | åˆ©ç”¨é¡5ä¸‡å†† or ã„ã„ã­10ä»¶ or æŠ•ç¨¿3ä»¶ | 5% |
| Gold | åˆ©ç”¨é¡20ä¸‡å†† or ã„ã„ã­30ä»¶ or æŠ•ç¨¿10ä»¶ | 10% |
| Platinum | åˆ©ç”¨é¡50ä¸‡å†† or ã„ã„ã­100ä»¶ or æŠ•ç¨¿30ä»¶ | 15% |

ãƒ©ãƒ³ã‚¯ã¯ `determine_user_rank()` RPCé–¢æ•°ã§è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚

### AuthContext ã®æä¾›æƒ…å ±

`src/contexts/AuthContext.tsx` ãŒæä¾›ã™ã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼š

```typescript
interface AuthContextType {
  user: User | null;          // Supabase Auth ãƒ¦ãƒ¼ã‚¶ãƒ¼
  session: Session | null;    // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±
  profile: UserProfile | null;// users ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰
  loading: boolean;
  signUp / signIn / signOut;  // èªè¨¼æ“ä½œ
  isAdmin / isStaff / isPartner / isMember;  // ãƒ­ãƒ¼ãƒ«åˆ¤å®š
  hasRole(roles: UserRole[]): boolean;
}
```

**ä½¿ç”¨ä¾‹:**
```typescript
const { isAdmin, profile } = useAuth();
if (isAdmin) { /* Adminå°‚ç”¨å‡¦ç† */ }
```

### RLSï¼ˆRow Level Securityï¼‰

å…¨32ãƒ†ãƒ¼ãƒ–ãƒ«ã« RLS ãŒæœ‰åŠ¹ã€‚ãƒãƒªã‚·ãƒ¼ã¯ `check_user_role()` é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿæ–½ã€‚

**ãƒ‘ã‚¿ãƒ¼ãƒ³:**
- å…¬é–‹ãƒ‡ãƒ¼ã‚¿: `FOR SELECT USING (true)`
- è‡ªå·±ãƒ‡ãƒ¼ã‚¿: `FOR ALL USING (auth.uid() = user_id)`
- ã‚¹ã‚¿ãƒƒãƒ•æ“ä½œ: `FOR ALL USING (check_user_role(ARRAY['Admin', 'Staff']))`
- ç®¡ç†è€…æ“ä½œ: `FOR ALL USING (check_user_role(ARRAY['Admin']))`

### ãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼‰

`src/components/ProtectedRoute.tsx` ãŒå…¨ä¿è­·ãƒ«ãƒ¼ãƒˆã‚’åˆ¶å¾¡:

| å‹•ä½œæ¡ä»¶ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|---|---|
| æœªãƒ­ã‚°ã‚¤ãƒ³ | `/login?redirect=å…ƒURL` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ |
| æ¨©é™ä¸è¶³ | `/` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ + ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ |
| ãƒ­ãƒ¼ãƒ‰ä¸­ | ã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤º |

**ä½¿ç”¨ä¾‹:**
```tsx
// ãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆã®ã¿
<ProtectedRoute><MyPage /></ProtectedRoute>

// Adminé™å®š
<ProtectedRoute allowedRoles={['Admin']}><AdminPage /></ProtectedRoute>

// Staff + Admin
<ProtectedRoute allowedRoles={['Admin', 'Staff']}><StaffPage /></ProtectedRoute>
```

> **äºŒé‡é˜²å¾¡:** RLSï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ï¼‰+ ãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼‰ã®2å±¤ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿæ–½ã€‚

---

## 6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ï¼ˆ32ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

| # | ã‚«ãƒ†ã‚´ãƒª | ãƒ†ãƒ¼ãƒ–ãƒ« | ç”¨é€” |
|---|---|---|---|
| 1 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ | `users` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»æ¨©é™ |
| 2 | ãƒã‚¹ã‚¿ | `categories` | å‹•çš„ã‚«ãƒ†ã‚´ãƒªï¼ˆæ©Ÿå™¨/å”åŠ›åº—/å•ã„åˆã‚ã›/è»Šä¸¡ï¼‰ |
| 3 | ãƒã‚¹ã‚¿ | `system_settings` | ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãƒ»ãƒ©ãƒ³ã‚¯è¨­å®šãƒ»æ”¯æ‰•ã„æ–¹æ³• |
| 4 | ã‚«ã‚¿ãƒ­ã‚° | `vehicles` | è»Šä¸¡ï¼ˆè²©å£²/ãƒ¬ãƒ³ã‚¿ãƒ«/ä¸¡æ–¹ï¼‰ |
| 5 | ã‚«ã‚¿ãƒ­ã‚° | `rental_vehicles` | ãƒ¬ãƒ³ã‚¿ãƒ«è»Šä¸¡ï¼ˆæ–™é‡‘ãƒ»ãƒŠãƒ³ãƒãƒ¼ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰ |
| 6 | ã‚«ã‚¿ãƒ­ã‚° | `equipment` | ãƒ¬ãƒ³ã‚¿ãƒ«æ©Ÿå™¨ |
| 7 | ã‚«ã‚¿ãƒ­ã‚° | `partners` | å”åŠ›åº—ãƒ»æ–½è¨­ |
| 8 | ã‚«ã‚¿ãƒ­ã‚° | `activities` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ |
| 9 | äºˆç´„ | `reservations` | ãƒ¬ãƒ³ã‚¿ãƒ«äºˆç´„ |
| 10 | äºˆç´„ | `reservation_equipment` | äºˆç´„ã«ç´ã¥ãæ©Ÿå™¨ |
| 11 | äºˆç´„ | `reservation_activities` | äºˆç´„ã«ç´ã¥ãã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ |
| 12-16 | ä½“é¨“è¨˜ | `stories` / `story_questions` / `story_answers` / `story_likes` / `story_favorites` | ä½“é¨“è¨˜ãƒ»è³ªå•/å›ç­”ãƒ»ã„ã„ã­ãƒ»ãŠæ°—ã«å…¥ã‚Š |
| 17-18 | Q&A | `questions` / `answers` | è³ªå•ãƒ»å›ç­” |
| 19-20 | ãƒ¬ãƒ“ãƒ¥ãƒ¼ | `reviews` / `review_helpfuls` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»å½¹ç«‹ã£ãŸæŠ•ç¥¨ |
| 21-22 | ã‚¤ãƒ™ãƒ³ãƒˆ | `events` / `event_participants` | ã‚¤ãƒ™ãƒ³ãƒˆãƒ»å‚åŠ ç™»éŒ² |
| 23-24 | ãŠæ°—ã«å…¥ã‚Š | `vehicle_favorites` / `partner_favorites` | è»Šä¸¡/å”åŠ›åº—ã®ãŠæ°—ã«å…¥ã‚Š |
| 25 | é€šçŸ¥ | `notifications` | ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ |
| 26-27 | ãƒ«ãƒ¼ãƒˆ | `routes` / `route_stops` | å¯„ã‚Šé“ãƒ«ãƒ¼ãƒˆãƒ»çµŒç”±åœ° |
| 28-29 | é‹ç”¨ | `rental_checklists` / `equipment_preparations` | è²¸å‡ºãƒã‚§ãƒƒã‚¯ãƒ»æ©Ÿå™¨æº–å‚™ |
| 30 | å•ã„åˆã‚ã› | `contacts` | ãŠå•ã„åˆã‚ã› |
| 31 | ç›£æŸ» | `admin_logs` | ç®¡ç†æ“ä½œãƒ­ã‚° |
| 32 | ãŠçŸ¥ã‚‰ã› | `announcements` | ãŠçŸ¥ã‚‰ã›è¨˜äº‹ |

### çµ±åˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

`supabase/migrations/20260207000000_complete_database_schema.sql`

æ–°è¦ç’°å¢ƒã§ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã¯ã€ã“ã®SQLã‚’ Supabase SQL ã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿè¡Œã™ã‚‹ã ã‘ã§OKã€‚

### ä¸»è¦ãªDBé–¢æ•°

| é–¢æ•° | èª¬æ˜ |
|---|---|
| `check_user_role(text[])` | RLSãƒãƒªã‚·ãƒ¼ç”¨ãƒ­ãƒ¼ãƒ«åˆ¤å®š |
| `handle_new_user()` | Authç™»éŒ²â†’usersãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®è‡ªå‹•INSERT |
| `update_updated_at_column()` | å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®updated_atè‡ªå‹•æ›´æ–° |
| `calculate_total_spent(uuid)` | åˆ©ç”¨åˆè¨ˆé¡ã®è¨ˆç®— |
| `calculate_total_likes(uuid)` | ã„ã„ã­åˆè¨ˆã®è¨ˆç®— |
| `calculate_total_posts(uuid)` | æŠ•ç¨¿æ•°ã®è¨ˆç®— |
| `determine_user_rank(uuid)` | ãƒ©ãƒ³ã‚¯åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ |
| `update_user_rank(uuid)` | ãƒ©ãƒ³ã‚¯æ›´æ–°å®Ÿè¡Œ |

è©³ç´°ã¯ [docs/DATABASE.md](./DATABASE.md) ã‚’å‚ç…§ã€‚

---

## 7. ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ãƒšãƒ¼ã‚¸ â†’ useQuery/useMutation â†’ Repository â†’ Supabase Client â†’ PostgreSQL
```

### BaseRepository

`src/lib/data-access/base/BaseRepository.ts` ãŒå…¨ãƒªãƒã‚¸ãƒˆãƒªã®åŸºåº•ã‚¯ãƒ©ã‚¹ã€‚
ä»¥ä¸‹ã®å…±é€šCRUDãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ï¼š

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---|---|
| `findById(id)` | IDæŒ‡å®šã§1ä»¶å–å¾— |
| `findAll()` | å…¨ä»¶å–å¾— |
| `create(data)` | æ–°è¦ä½œæˆ |
| `update(id, data)` | æ›´æ–° |
| `delete(id)` | å‰Šé™¤ |

### ãƒªãƒã‚¸ãƒˆãƒªä¸€è¦§ï¼ˆ20å€‹ï¼‰

| ãƒªãƒã‚¸ãƒˆãƒª | ãƒ†ãƒ¼ãƒ–ãƒ« | ä¸»ãªè¿½åŠ ãƒ¡ã‚½ãƒƒãƒ‰ |
|---|---|---|
| `UserRepository` | users | ãƒ­ãƒ¼ãƒ«å¤‰æ›´ã€ãƒ©ãƒ³ã‚¯æ›´æ–° |
| `VehicleRepository` | vehicles, rental_vehicles | â€” |
| `RentalFlowRepository` | reservations ç­‰ | `getAvailableVehicles()`, `checkOverlap()`, `createReservation()` |
| `ReservationRepository` | reservations | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ |
| `EquipmentRepository` | equipment | åœ¨åº«ç®¡ç† |
| `PartnerRepository` | partners | â€” |
| `ActivityRepository` | activities | â€” |
| `StoryRepository` | stories | ã„ã„ã­ã€ãŠæ°—ã«å…¥ã‚Šç®¡ç† |
| `StoryQuestionRepository` | story_questions, story_answers | â€” |
| `QuestionRepository` | questions, answers | ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼ã€å½¹ç«‹ã£ãŸ |
| `ReviewRepository` | reviews | â€” |
| `EventRepository` | events | â€” |
| `EventParticipantRepository` | event_participants | â€” |
| `AnnouncementRepository` | announcements | â€” |
| `ContactRepository` | contacts | â€” |
| `CategoryRepository` | categories | â€” |
| `RouteRepository` | routes, route_stops | â€” |
| `RentalChecklistRepository` | rental_checklists, equipment_preparations | ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç®¡ç† |
| `SystemSettingsRepository` | system_settings | â€” |
| `AnswerRepository` | answers | â€” |

### ã‚«ã‚¹ã‚¿ãƒ Hooks

```typescript
// ãƒ‡ãƒ¼ã‚¿å–å¾—
const { data, loading, error, refetch } = useQuery(
  () => repository.findAll()
);

// ãƒ‡ãƒ¼ã‚¿å¤‰æ›´
const { mutate, loading } = useMutation(
  (data) => repository.create(data),
  { onSuccess: () => refetch() }
);
```

### ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯: ãƒ¬ãƒ³ã‚¿ãƒ«äºˆç´„ãƒãƒƒãƒ•ã‚¡

`RentalFlowRepository.getAvailableVehicles()` ã¯ã€äºˆç´„ã®å‰å¾Œ Â±1æ—¥ ã‚’ãƒãƒƒãƒ•ã‚¡ã¨ã—ã¦ç¢ºä¿ã—ã€æº–å‚™ãƒ»è¿”å´æ—¥ã‚’è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿äºˆç´„ã¯é™¤å¤–ã•ã‚Œã¾ã™ã€‚

è©³ç´°ã¯ [docs/API.md](./API.md) ã‚’å‚ç…§ã€‚

---

## 8. å¤–éƒ¨APIé€£æº

### 8.1 Supabase

**ç”¨é€”:** ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€èªè¨¼ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€Edge Functions

| æ©Ÿèƒ½ | ä½¿ç”¨ç®‡æ‰€ |
|---|---|
| Auth | å…¨èªè¨¼å‡¦ç† (`AuthContext.tsx`) |
| Database (REST) | å…¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆRepository â†’ supabase clientï¼‰ |
| Storage | ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (`imageUpload.ts`) |
| Edge Functions | Stripeæ±ºæ¸ˆ (`create-payment-intent`) |

**è¨­å®š:**
```env
VITE_SUPABASE_URL=<ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURL>
VITE_SUPABASE_ANON_KEY=<Anon Key>
```

### 8.2 Google Maps API

**ç”¨é€”:** å”åŠ›åº—ãƒ»ä½“é¨“è¨˜ã®æ–½è¨­åæ¤œç´¢ï¼ˆPlaceAutocompleteï¼‰

**å¿…è¦ãªAPI:**
- Maps JavaScript API
- Places APIï¼ˆâ€»æ—§ç‰ˆã€‚Places API (New) ã§ã¯ãªã„ï¼‰

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/hooks/useGoogleMapsLoader.ts` â€” API ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ãƒ¼ãƒ€ãƒ¼
- `src/components/PlaceAutocomplete.tsx` â€” æ¤œç´¢UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ä½¿ç”¨ãƒšãƒ¼ã‚¸:**
- `/admin/partners/new` (å”åŠ›åº—ç™»éŒ²)
- `/admin/partners/:id/edit` (å”åŠ›åº—ç·¨é›†)
- `/portal/stories/new` (ä½“é¨“è¨˜æŠ•ç¨¿)
- `/portal/stories/:id/edit` (ä½“é¨“è¨˜ç·¨é›†)

**è¨­å®š:**
```env
VITE_GOOGLE_MAPS_API_KEY=<APIã‚­ãƒ¼>
```

> âš ï¸ APIã‚­ãƒ¼ã® HTTP ãƒªãƒ•ã‚¡ãƒ©ãƒ¼åˆ¶é™ã« `http://localhost:5173/*` ã¨æœ¬ç•ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã€‚

### 8.3 Stripe

**ç”¨é€”:** ãƒ¬ãƒ³ã‚¿ãƒ«äºˆç´„ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ±ºæ¸ˆ

**å®Ÿè£…:**
- `supabase/functions/create-payment-intent/` â€” Edge Functionï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ï¼‰
- `@stripe/stripe-js` â€” ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆSDK

**ãƒ•ãƒ­ãƒ¼:**
```
äºˆç´„ç¢ºèª â†’ Edge Functionå‘¼ã³å‡ºã— â†’ PaymentIntentä½œæˆ â†’ Stripeæ±ºæ¸ˆç”»é¢ â†’ å®Œäº†
```

**è¨­å®š:**
```env
VITE_STRIPE_PUBLISHABLE_KEY=<å…¬é–‹ã‚­ãƒ¼>
# Edge Functionå´ã« STRIPE_SECRET_KEY ã‚’è¨­å®š
```

---

## 9. ä¸»è¦æ©Ÿèƒ½ã®å®Ÿè£…è©³ç´°

### 9.1 ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ•ãƒ­ãƒ¼

4ã‚¹ãƒ†ãƒƒãƒ—ã®äºˆç´„ãƒ—ãƒ­ã‚»ã‚¹:

```mermaid
flowchart LR
    A["/rental<br>æ—¥ä»˜ãƒ»å ´æ‰€é¸æŠ"] --> B["/rental/vehicles<br>è»Šä¸¡é¸æŠ"]
    B --> C["/rental/equipment<br>æ©Ÿå™¨é¸æŠ"]
    C --> D["/rental/activities<br>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£é¸æŠ"]
    D --> E["/rental/confirm<br>ç¢ºèªãƒ»æ±ºæ¸ˆ"]
```

**çŠ¶æ…‹ç®¡ç†:** ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ + URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§é¸æŠçŠ¶æ…‹ã‚’ã‚¹ãƒ†ãƒƒãƒ—é–“ã§ä¿æŒã€‚

**äºˆç´„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»:**
```
Pending â†’ Confirmed â†’ InProgress â†’ Completed
                   â†˜ Cancelled
```

**ãƒãƒƒãƒ•ã‚¡æ—¥åˆ¶å¾¡:**
- ç¢ºå®šæ¸ˆã¿äºˆç´„ã®å‰å¾ŒÂ±1æ—¥ã‚’è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯
- `RentalFlowRepository.getAvailableVehicles()` ã¨ `checkOverlap()` ã§å®Ÿè£…

### 9.2 ä½“é¨“è¨˜ï¼ˆStoriesï¼‰

- Markdown ãƒ™ãƒ¼ã‚¹ã®ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- ä½ç½®æƒ…å ±ï¼ˆGoogle Placesé€£æºï¼‰
- ã„ã„ã­ / ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯
- è³ªå• / å›ç­”ã®ã‚¹ãƒ¬ãƒƒãƒ‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: Draft â†’ Published â†’ Archived

### 9.3 ç®¡ç†ç”»é¢

`AdminLayout.tsx` + `StaffSidebar.tsx` ãŒãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã€‚

å„ç®¡ç†ãƒšãƒ¼ã‚¸ã¯ç›´æ¥ `supabase` ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã€RepositoryçµŒç”±ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ··åœ¨ã—ã¦ã„ã¾ã™ã€‚æ–°è¦é–‹ç™ºæ™‚ã¯ Repository ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¨å¥¨ã€‚

### 9.4 ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢

| ãƒšãƒ¼ã‚¸ | URL | æ©Ÿèƒ½ |
|---|---|---|
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | `/staff` | æœ¬æ—¥ã®è²¸å‡º/è¿”å´ä¸€è¦§ |
| è²¸å‡ºå‡¦ç† | `/staff/checkout/:id` | ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®è²¸å‡ºç¢ºèª |
| è¿”å´å‡¦ç† | `/staff/return/:id` | è¿”å´ãƒã‚§ãƒƒã‚¯ãƒ»çŠ¶æ…‹ç¢ºèª |

### 9.5 PlaceAutocomplete

`PlaceAutocomplete.tsx` ã¯ Google Places API ã‚’ä½¿ã£ã¦æ–½è¨­åã‚’æ¤œç´¢ã—ã€é¸æŠã—ãŸæ–½è¨­ã®ä»¥ä¸‹ã®æƒ…å ±ã‚’è‡ªå‹•å…¥åŠ›:

- ä½æ‰€
- é›»è©±ç•ªå·
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- ç·¯åº¦ãƒ»çµŒåº¦
- ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ

API ãŒåˆ©ç”¨ã§ããªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆæ‰‹å‹•å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ï¼‰ã‚‚å®Ÿè£…æ¸ˆã¿ã€‚

### 9.6 æ”¯æ‰•ã„æ–¹æ³•è¨­å®š

`system_settings.payment_method` ã§ç®¡ç†è€…ãŒã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ”¯æ‰•ã„æ–¹æ³•ã‚’åˆ‡æ›¿å¯èƒ½:
- `card_only` â€” ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã®ã¿
- `onsite_only` â€” ç¾åœ°æ‰•ã„ã®ã¿
- `both` â€” ä¸¡æ–¹

`SystemSettingsPage.tsx` ã‹ã‚‰è¨­å®šå¤‰æ›´å¯èƒ½ã€‚

---

## 10. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸€è¦§

`src/App.tsx` ã§å…¨ãƒ«ãƒ¼ãƒˆã‚’å®šç¾©ã€‚å…¨ãƒšãƒ¼ã‚¸ã¯ `lazy()` + `Suspense` ã§é…å»¶èª­ã¿è¾¼ã¿ã€‚`ProtectedRoute` ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚ã‚Šã€‚

### å…¬é–‹ãƒšãƒ¼ã‚¸ï¼ˆèªè¨¼ä¸è¦ï¼‰
| ãƒ‘ã‚¹ | ãƒšãƒ¼ã‚¸ |
|---|---|
| `/` | ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ |
| `/vehicles` | è»Šä¸¡ä¸€è¦§ |
| `/vehicles/:id` | è»Šä¸¡è©³ç´° |
| `/partners` | å”åŠ›åº—ä¸€è¦§ |
| `/partners/:id` | å”åŠ›åº—è©³ç´° |
| `/portal` | ãƒãƒ¼ã‚¿ãƒ«ãƒˆãƒƒãƒ— |
| `/portal/stories`, `/portal/stories/:id` | ä½“é¨“è¨˜ä¸€è¦§ãƒ»è©³ç´° |
| `/portal/events`, `/portal/events/:id` | ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ãƒ»è©³ç´° |
| `/portal/questions`, `/portal/questions/:id` | Q&Aä¸€è¦§ãƒ»è©³ç´° |
| `/portal/announcements`, `/portal/news` | ãŠçŸ¥ã‚‰ã›ä¸€è¦§ |
| `/about` | ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦ |
| `/contact` | ãŠå•ã„åˆã‚ã› |
| `/privacy` | ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ |
| `/terms` | åˆ©ç”¨è¦ç´„ |

### èªè¨¼
| ãƒ‘ã‚¹ | ãƒšãƒ¼ã‚¸ |
|---|---|
| `/login` | ãƒ­ã‚°ã‚¤ãƒ³ |
| `/register` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² |
| `/forgot-password` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”³è«‹ |
| `/reset-password` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š |
| `/auth/callback` | OAuth/ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

### èªè¨¼å¿…é ˆãƒšãƒ¼ã‚¸ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã®ã¿å¿…è¦ã€ãƒ­ãƒ¼ãƒ«ä¸å•ï¼‰
| ãƒ‘ã‚¹ | ãƒšãƒ¼ã‚¸ |
|---|---|
| `/rental` | ãƒ¬ãƒ³ã‚¿ãƒ«ï¼ˆæ—¥ä»˜é¸æŠï¼‰ |
| `/rental/vehicles` | è»Šä¸¡é¸æŠ |
| `/rental/equipment` | æ©Ÿå™¨é¸æŠ |
| `/rental/activities` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£é¸æŠ |
| `/rental/confirm` | ç¢ºèªãƒ»æ±ºæ¸ˆ |
| `/vehicles/review` | è»Šä¸¡ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ |
| `/partners/:id/review` | å”åŠ›åº—ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| `/reviews/:id/edit` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ç·¨é›† |
| `/portal/stories/new`, `.../edit` | ä½“é¨“è¨˜æŠ•ç¨¿ãƒ»ç·¨é›† |
| `/portal/events/new`, `.../edit` | ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ»ç·¨é›† |
| `/portal/questions/new`, `.../edit` | è³ªå•æŠ•ç¨¿ãƒ»ç·¨é›† |
| `/route`, `/routes` | å¯„ã‚Šé“ãƒ«ãƒ¼ãƒˆ |
| `/my`, `/my-page`, `/mypage` | ãƒã‚¤ãƒšãƒ¼ã‚¸ |

### Admin å°‚ç”¨ãƒšãƒ¼ã‚¸ï¼ˆ`allowedRoles: ['Admin']`ï¼‰
| ãƒ‘ã‚¹ | ãƒšãƒ¼ã‚¸ |
|---|---|
| `/admin` | ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |
| `/admin/users` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† |
| `/admin/vehicles`, `/new`, `/:id/edit` | ãƒ¬ãƒ³ã‚¿ãƒ«è»Šä¸¡ç®¡ç† |
| `/admin/sale-vehicles`, `/new`, `/edit/:id` | è²©å£²è»Šä¸¡ç®¡ç† |
| `/admin/equipment`, `/new`, `/:id/edit` | æ©Ÿå™¨ç®¡ç† |
| `/admin/partners`, `/new`, `/:id/edit` | å”åŠ›åº—ç®¡ç† |
| `/admin/activities` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ç®¡ç† |
| `/admin/reservations` | äºˆç´„ç®¡ç† |
| `/admin/stories` | ä½“é¨“è¨˜ç®¡ç† |
| `/admin/reviews` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç† |
| `/admin/questions` | Q&Aç®¡ç† |
| `/admin/contacts` | ãŠå•ã„åˆã‚ã›ç®¡ç† |
| `/admin/categories` | ã‚«ãƒ†ã‚´ãƒªç®¡ç† |
| `/admin/content` | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç† |
| `/admin/news` | ãŠçŸ¥ã‚‰ã›ç®¡ç† |
| `/admin/settings` | ã‚·ã‚¹ãƒ†ãƒ è¨­å®š |

### Staff + Admin ãƒšãƒ¼ã‚¸ï¼ˆ`allowedRoles: ['Admin', 'Staff']`ï¼‰
| ãƒ‘ã‚¹ | ãƒšãƒ¼ã‚¸ |
|---|---|
| `/staff` | ã‚¹ã‚¿ãƒƒãƒ•ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |
| `/staff/checkout/:id` | è²¸å‡ºå‡¦ç† |
| `/staff/return/:id` | è¿”å´å‡¦ç† |
| `/staff/contacts` | ãŠå•ã„åˆã‚ã› |
| `/staff/stories` | ä½“é¨“è¨˜ç®¡ç† |
| `/staff/reviews` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç† |
| `/staff/questions` | Q&Aç®¡ç† |

### Partner + Admin ãƒšãƒ¼ã‚¸ï¼ˆ`allowedRoles: ['Admin', 'Partners']`ï¼‰
| ãƒ‘ã‚¹ | ãƒšãƒ¼ã‚¸ |
|---|---|
| `/partner/dashboard` | å”åŠ›åº—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |

---

## 11. é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶
- Node.js 18+
- npm
- Supabase ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Google Cloud Console ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆPlaces APIç”¨ï¼‰
- Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆæ±ºæ¸ˆæ©Ÿèƒ½ç”¨ï¼‰

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone git@github.com:tsa-slack/NetmariWeb.git
cd NetmariWeb

# 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 3. ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.sample .env
# .env ã‚’ç·¨é›†ï¼ˆä»¥ä¸‹ã®å€¤ã‚’è¨­å®šï¼‰

# 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev
# â†’ http://localhost:5173
```

### ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | å–å¾—å…ƒ |
|---|---|---|
| `VITE_SUPABASE_URL` | Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURL | Supabase Dashboard â†’ Settings â†’ API |
| `VITE_SUPABASE_ANON_KEY` | Supabase Anon Key | åŒä¸Š |
| `VITE_STRIPE_PUBLISHABLE_KEY` | Stripeå…¬é–‹ã‚­ãƒ¼ | Stripe Dashboard â†’ Developers â†’ API keys |
| `VITE_GOOGLE_MAPS_API_KEY` | Google Maps APIã‚­ãƒ¼ | Google Cloud Console â†’ èªè¨¼æƒ…å ± |

### Google Maps API è¨­å®š

1. [Google Cloud Console](https://console.cloud.google.com/) ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. **Maps JavaScript API** ã¨ **Places API** ã‚’æœ‰åŠ¹åŒ–
3. èªè¨¼æƒ…å ±ã‹ã‚‰APIã‚­ãƒ¼ã‚’ä½œæˆ
4. HTTPãƒªãƒ•ã‚¡ãƒ©ãƒ¼åˆ¶é™:
   - é–‹ç™º: `http://localhost:5173/*`
   - æœ¬ç•ª: `https://yourdomain.com/*`

### é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

```bash
npm run dev        # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run build      # æœ¬ç•ªãƒ“ãƒ«ãƒ‰ï¼ˆdist/ ã«å‡ºåŠ›ï¼‰
npm run preview    # ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
npm run lint       # ESLint å®Ÿè¡Œ
npm run typecheck  # TypeScript å‹ãƒã‚§ãƒƒã‚¯
npm test           # Vitest ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:watch # ãƒ†ã‚¹ãƒˆã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
```

---

## 12. ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ“ãƒ«ãƒ‰

```bash
npm run build
# â†’ dist/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆ
```

### ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ

**Vercelï¼ˆæ¨å¥¨ï¼‰** ã¾ãŸã¯ **Netlify**

| è¨­å®š | å€¤ |
|---|---|
| ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ | `npm run build` |
| å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | `dist` |
| Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 18+ |

### ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å…ˆï¼‰

æœ¬ç•ªç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆï¼ˆNetlifyï¼‰ã®è¨­å®šç”»é¢ã§ç™»éŒ²:

```
VITE_SUPABASE_URL=<æœ¬ç•ªSupabase URL>
VITE_SUPABASE_ANON_KEY=<æœ¬ç•ªSupabase Anon Key>
VITE_STRIPE_PUBLISHABLE_KEY=<æœ¬ç•ªStripeå…¬é–‹ã‚­ãƒ¼>
VITE_GOOGLE_MAPS_API_KEY=<æœ¬ç•ªGoogle Maps APIã‚­ãƒ¼>
```

### Supabase Edge Functions ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Supabase CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g supabase

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ³ã‚¯
supabase link --project-ref <PROJECT_REF>

# Edge Functions ãƒ‡ãƒ—ãƒ­ã‚¤
supabase functions deploy create-payment-intent

# Secret è¨­å®šï¼ˆStripeã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ï¼‰
supabase secrets set STRIPE_SECRET_KEY=<ã‚­ãƒ¼>
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

æ–°è¦ç’°å¢ƒã§ã¯ `supabase/migrations/20260207000000_complete_database_schema.sql` ã‚’ Supabase SQL ã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿè¡Œã€‚

---

## 13. ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆæ§‹æˆ

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:** Vitest + jsdom
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«:** `src/lib/data-access/base/__tests__/`, `src/lib/data-access/hooks/__tests__/`

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
npm test           # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:watch # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
```

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆé …ç›®

`test.md` ã«ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ126é …ç›®ï¼‰ã‚’è¨˜è¼‰ã€‚ã‚«ãƒãƒ¼ç¯„å›²:

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° |
|---|---|
| ã‚²ã‚¹ãƒˆæ“ä½œ | 15 |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»ç™»éŒ² | 12 |
| ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ•ãƒ­ãƒ¼ | 14 |
| ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½ | 20 |
| ãƒã‚¤ãƒšãƒ¼ã‚¸ | 18 |
| ç®¡ç†ç”»é¢ | 30 |
| ã‚¹ã‚¿ãƒƒãƒ•æ“ä½œ | 10 |
| å”åŠ›åº—æ“ä½œ | 7 |

---

## 14. æ—¢çŸ¥ã®èª²é¡Œãƒ»ä»Šå¾Œã®æ”¹å–„ç‚¹

### æŠ€è¡“çš„èª²é¡Œ

| # | èª²é¡Œ | å„ªå…ˆåº¦ | è©³ç´° |
|---|---|---|---|
| ~~1~~ | ~~ãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰ã®ä¸åœ¨~~ | ~~é«˜~~ | âœ… **è§£æ±ºæ¸ˆã¿** â€” `ProtectedRoute` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å…¨ä¿è­·ãƒ«ãƒ¼ãƒˆã«ã‚¬ãƒ¼ãƒ‰é©ç”¨ï¼ˆ2026-02-14ï¼‰ |
| 2 | ç®¡ç†ç”»é¢ã®ç›´æ¥Supabaseå‘¼ã³å‡ºã— | ä¸­ | ä¸€éƒ¨ã®ç®¡ç†ãƒšãƒ¼ã‚¸ãŒRepositoryã‚’ä½¿ã‚ãšç›´æ¥supabase clientã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ |
| 3 | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸€è²«æ€§ | ä¸­ | ãƒšãƒ¼ã‚¸ã«ã‚ˆã£ã¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç•°ãªã‚‹ |
| 4 | ç”»åƒæœ€é©åŒ– | ä½ | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã®ãƒªã‚µã‚¤ã‚ºãƒ»åœ§ç¸®ãŒæœªå®Ÿè£… |
| 5 | i18nï¼ˆå¤šè¨€èªå¯¾å¿œï¼‰ | ä½ | ç¾åœ¨ã¯æ—¥æœ¬èªã®ã¿ã€‚categories ãƒ†ãƒ¼ãƒ–ãƒ«ã« `label_en` ã¯ç”¨æ„æ¸ˆã¿ |

### æ©Ÿèƒ½é¢ã®æ”¹å–„å€™è£œ

| # | é …ç›® | èª¬æ˜ |
|---|---|---|
| 1 | ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ | `notifications` ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å­˜åœ¨ã™ã‚‹ãŒã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ã¯æœªå®Ÿè£… |
| 2 | ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ | äºˆç´„ç¢ºèªãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´æ™‚ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯æœªå®Ÿè£… |
| 3 | æ¤œç´¢æ©Ÿèƒ½ã®å¼·åŒ– | å…¨æ–‡æ¤œç´¢ï¼ˆSupabase Full Text Searchï¼‰ã®æ´»ç”¨ |
| 4 | SEOå¯¾ç­– | SSR/SSG ã®å°å…¥æ¤œè¨ï¼ˆç¾åœ¨ã¯SPAï¼‰ |
| 5 | PWAåŒ– | Service Worker ã«ã‚ˆã‚‹ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ |
| 6 | ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ | ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æã®å°å…¥ |

---

## 15. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ‘ã‚¹ | å†…å®¹ |
|---|---|---|
| README | [README.md](../README.md) | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— |
| APIå®šç¾©æ›¸ | [docs/API.md](./API.md) | APIãƒ»èªè¨¼ãƒ»RLSãƒ»æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹ |
| DBå®šç¾©æ›¸ | [docs/DATABASE.md](./DATABASE.md) | ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ãƒ»é–¢æ•°ãƒ»ERå›³ |
| ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ | [src/lib/data-access/README.md](../src/lib/data-access/README.md) | Repository ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ã„æ–¹ |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ | [src/lib/data-access/MIGRATION_GUIDE.md](../src/lib/data-access/MIGRATION_GUIDE.md) | ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã¸ã®ç§»è¡Œæ‰‹é † |
| ãƒ†ã‚¹ãƒˆè¨ˆç”»æ›¸ | [test.md](../test.md) | å…¨æ“ä½œã®ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ |

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | è‘—è€… | å†…å®¹ |
|---|---|---|
| 2026-02-11 | å‰ç”° æµ©æ¨¹ | åˆç‰ˆä½œæˆ |
| 2026-02-14 | AI | ãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰å®Ÿè£…ãƒ»ProtectedRoute è¿½åŠ  |
